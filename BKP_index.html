<!DOCTYPE html>
<html>

<head>
    <title>unplace.org // GBNT</title>
    <script src="js/jquery-1.11.2.min.js"></script>
    <script src="js/packery.pkgd.js"></script>
    <script src="js/imagesloaded.pkgd.min.js"></script>

    <script type="text/javascript">
    var _iv_normal = 70; // random percent for NORMAL squares
    var _iv_tall = 15; // random percent for TALL squares
    var _iv_wide = 15; // random percent for WIDE squares

    var _projectsList = [];

    // Create a deferred object
    var _dfd = $.Deferred();
    _dfd.done(createHTML);

    docReady(function() {
        // readInputValues();
        prepareData();


    });

    function prepareData() {
        $.get("projectos/lista_dos_projectos.txt", function(data) {
            _projectsList = data.split(",");
            for (var i = 0; i < _projectsList.length; i++) {
                createObject(_projectsList[i]);
            }
        });
    }

    function checkAllDone(projID) {
        var doResolve = true;
        for (var i = 0; i < window._projectsList.length; i++) {
            if (projID === window._projectsList[i]) {
                window._projectsList[i] = null;
                break;
            }
        }

        for (var ii = 0; ii < window._projectsList.length; ii++) {
            if (!isNaN(window._projectsList[ii]) && typeof window._projectsList[ii] !== "object") {
                doResolve = false;
                break;
            }
        }

        if (doResolve) {
            // Let's party
            window._dfd.resolve();
        }

    }

    function createObject(projectID) {
        $.get("projectos/" + projectID, {}, function(data) {
            $.get("projectos/" + projectID + "/sumario.json", function(sumario) {
                sumario.id = this.url.split("/")[1];
                window._projectsList.push(sumario);
                checkAllDone(sumario.id);
            }).fail(function() {
                var tmpID = this.url.split("/")[1];
                checkAllDone(tmpID);
            });
        }).fail(function() {
            var tmpID = this.url.split("/")[1];
            checkAllDone(tmpID);
        });
    }

    function createHTML() {
        createTheDivs();
        // randomizeDIVs();
        // initializePackery();
    }

    function createTheDivs() {
        var mainContainer = $("#mainContainer");
        mainContainer.css("border", "1px solid black");

        var rnd = Math.floor((Math.random() * 100) + 1);
        var boxSize = "item-normal";

        if (rnd >= 0 && rnd < this._iv_normal) {
            boxSize = "item-normal";
        }

        if (rnd >= this._iv_normal && rnd < this._iv_normal + this._iv_wide) {
            boxSize = "item-wide";
        }

        if (rnd >= this._iv_normal + this._iv_wide && rnd <= this._iv_normal + this._iv_wide + this._iv_tall) {
            boxSize = "item-tall";
        }

        for (var i = 0; i < window._projectsList.length; i++) {
            if (window._projectsList[i]) {
                mainContainer.append(singleDiv(boxSize, window._projectsList[i]));
            }
        }
    }

    function singleDiv(cssClass, obj) {
        var divBox = $("<div/>", {
            id: "box_" + obj.id,
            class: cssClass
        }).append($("<div/>", {
            id: "overlay",
            class: cssClass
        })).append($("<a/>", {
            href: "#",
            class: "textbox"
        })).append($("<span/>", {
            text: obj.titulo,
            class: "titulo"
        })).append($("<span/>", {
            text: obj.autor,
            class: "autor"
        }));

        return divBox;
    }

    function randomizeDIVs() {
        var cards = $(".item");
        for (var i = 0; i < cards.length; i++) {
            var target = Math.floor(Math.random() * cards.length - 1) + 1;
            var target2 = Math.floor(Math.random() * cards.length - 1) + 1;
            cards.eq(target).before(cards.eq(target2));
        }
    }

    function initializePackery() {
        var container = document.querySelector('.packery');
        var pckry;

        imagesLoaded(container, function() {
            pckry = new Packery(container, {
                itemSelector: '.item',
                gutter: 10
            });
        });
    }
    </script>
</head>

<body>
    <style type="text/css">
    * {
        -webkit-box-sizing: border-box;
        -moz-box-sizing: border-box;
        box-sizing: border-box;
    }
    body {
        overflow-y: scroll;
    }
    .packery {
        background: #fff;
        /*max-width: 1200px;*/
        /*margin: 0 auto;*/
    }
    /* clearfix */
    
    .packery:after {
        content: ' ';
        display: block;
        clear: both;
    }
    .item {
        width: 150px;
        float: left;
    }
    .item.big {
        height: 310px;
    }
    .item img {
        width: 100%;
        display: block;
    }
    .box {
        /*pointer-events: pointer;*/
        
        width: 150px;
        height: 150px;
        background: url(http://placehold.it/200x200);
    }
    .box:hover #overlay {
        pointer-events: pointer;
        opacity: 1;
    }
    #overlay {
        width: 150px;
        height: 150px;
        background: rgba(0, 0, 0, .75);
        opacity: 0;
        -webkit-transition: opacity.25s ease;
        -moz-transition: opacity.25s ease;
    }
    #overlay .textbox {
        padding: 10px;
        display: block;
        height: 100%;
        width: 100%;
        text-decoration: none;
    }
    #overlay .titulo {
        color: #fff;
        font-family: Helvetica;
        font-size: 96 px;
    }
    #overlay .autor {
        color: #fff;
        font-family: Helvetica;
        font-weight: 900;
        font-size: 96 px;
    }
    </style>

    <div id="zrq">

    </div>


    <div id="mainContainer" class="packery">
    
      <!--   <div class="item big"><img src="http://lorempixel.com/150/310/?1" />
        </div>
        <div id="box_01" class="item box">
            <div id="overlay">
                <a href="#" class="textbox">
                    <span class="titulo">Observartion and Draw from 000</span>
                    <span class="autor">Andre Sier</span>
                </a>
            </div>
        </div>
        <div class="item"><img src="http://lorempixel.com/200/200/?3" />
        </div>
        <div class="item"><img src="http://lorempixel.com/200/200/?4" />
        </div>
        <div class="item"><img src="http://lorempixel.com/200/200/?5" />
        </div>
        <div class="item"><img src="http://lorempixel.com/200/200/?6" />
        </div>
        <div class="item"><img src="http://lorempixel.com/200/200/?7" />
        </div>
        <div class="item"><img src="http://lorempixel.com/200/200/?8" />
        </div>
        <div class="item"><img src="http://lorempixel.com/200/200/?9" />
        </div>
        <div class="item"><img src="http://lorempixel.com/200/200/?1" />
        </div>
        <div class="item"><img src="http://lorempixel.com/200/200/?2" />
        </div>
        <div class="item"><img src="http://lorempixel.com/200/200/?3" />
        </div>
        <div class="item big"><img src="http://lorempixel.com/150/310/?4" />
        </div>
        <div class="item"><img src="http://lorempixel.com/200/200/?5" />
        </div>
        <div class="item"><img src="http://lorempixel.com/200/200/?6" />
        </div>
        <div class="item"><img src="http://lorempixel.com/200/200/?7" />
        </div>
        <div class="item"><img src="http://lorempixel.com/200/200/?8" />
        </div>
        <div class="item "><img src="http://lorempixel.com/200/200/?9" />
        </div>
        <div class="item"><img src="http://lorempixel.com/200/200/?1" />
        </div>
        <div class="item "><img src="http://lorempixel.com/200/200/?2" />
        </div>
        <div class="item"><img src="http://lorempixel.com/200/200/?3" />
        </div>
        <div class="item big"><img src="http://lorempixel.com/150/310/?4" />
        </div>
        <div class="item "><img src="http://lorempixel.com/200/200/?5" />
        </div>
        <div class="item"><img src="http://lorempixel.com/200/200/?6" />
        </div>
        <div class="item"><img src="http://lorempixel.com/200/200/?7" />
        </div>
        <div class="item"><img src="http://lorempixel.com/200/200/?8" />
        </div>
        <div class="item"><img src="http://lorempixel.com/200/200/?9" />
        </div>
        <div class="item"><img src="http://lorempixel.com/200/200/?1" />
        </div>
        <div class="item "><img src="http://lorempixel.com/200/200/?2" />
        </div>
        <div class="item big"><img src="http://lorempixel.com/150/310/?3" />
        </div>
        <div class="item"><img src="http://lorempixel.com/200/200/?4" />
        </div>
        <div class="item"><img src="http://lorempixel.com/200/200/?5" />
        </div>
        <div class="item"><img src="http://lorempixel.com/200/200/?6" />
        </div>
        <div class="item"><img src="http://lorempixel.com/200/200/?7" />
        </div>
        <div class="item"><img src="http://lorempixel.com/200/200/?8" />
        </div>
        <div class="item"><img src="http://lorempixel.com/200/200/?9" />
        </div>
        <div class="item"><img src="http://lorempixel.com/200/200/?1" />
        </div>
        <div class="item"><img src="http://lorempixel.com/200/200/?2" />
        </div>
        <div class="item"><img src="http://lorempixel.com/200/200/?3" />
        </div>
        <div class="item"><img src="http://lorempixel.com/200/200/?4" />
        </div>
        <div class="item big"><img src="http://lorempixel.com/150/310/?5" />
        </div>
        <div class="item"><img src="http://lorempixel.com/200/200/?6" />
        </div>
        <div class="item"><img src="http://lorempixel.com/200/200/?7" />
        </div>
        <div class="item"><img src="http://lorempixel.com/200/200/?8" />
        </div>
        <div class="item"><img src="http://lorempixel.com/200/200/?9" />
        </div> -->
    </div>



</body>

</html>
