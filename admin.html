<!DOCTYPE html>
<html>

<head>
    <title>ADMIN unplace.org // GBNT</title>
    <link rel="stylesheet" href="css/pure-min.css" />
    <style type="text/css">
    * {
        -webkit-box-sizing: border-box;
        -moz-box-sizing: border-box;
        box-sizing: border-box;
    }
    
    body {
        margin: 50px;
        background-color: #fff;
    }
    
    .button-warning {
        background: rgb(223, 117, 20);
        color: white;
        border-radius: 4px;
        text-shadow: 0 1px 1px rgba(0, 0, 0, 0.2);
    }
    
    .hidden-input {
        display: none !important;
    }
    
    .tipo-capa-group p {
        display: inline;
        margin-left: 10px;
        font-size: 12px;
        color: red;
    }
    
    .box-images {
        margin-top: 10px;
        margin-bottom: 10px;
        padding: 10px;
        display: none;
        background-color: #ddd
    }
    
    .box-images h5 {
        margin: 0px;
    }
    
    .box-images .images p {
        margin: 8px;
        font-size: 12px;
        color: red;
    }
    
    .box-videos {
        margin-top: 10px;
        margin-bottom: 10px;
        padding: 10px;
        display: none;
        background-color: #ddd
    }
    
    .box-videos h5 {
        margin: 0px;
    }
    
    .box-videos .videos p {
        margin: 8px;
        font-size: 12px;
        color: red;
    }
    </style>
</head>

<body>
    <a class="button-warning pure-button" href="admin-visitas.html">Gerir Visitas</a>
    <hr>
    <form class="pure-form  pure-form-aligned">
        <div class="pure-control-group">
            <label for="idioma">Escolher idioma</label>
            <select id="idioma">
                <option value="pt">PT</option>
                <option value="en">EN</option>
            </select>
        </div>
        <div class="pure-g">
            <div class="pure-u-1-2">
                <h2>Informação da obra</h2>
                <div class="pure-control-group">
                    <label for="titulo">Título da obra</label>
                    <input id="titulo" type="text">
                </div>
                <div class="pure-control-group">
                    <label for="descricao">Descrição da obra</label>
                    <textarea id="descricao"></textarea>
                </div>
                <div class="pure-control-group">
                    <label for="www">URL da obra</label>
                    <input id="www" type="url" placeholder="http://...">
                </div>
                <div class="pure-control-group">
                    <label for="ano">Ano da obra</label>
                    <input maxlength="4" id="ano" type="text">
                </div>
                <div class="pure-control-group">
                    <input class="hidden-input ficha-tecnica" accept=".pdf" type="file" name="file">
                    <label for="fichaTecnica">Ficha Técnica (PDF)</label>
                    <input readonly id="fichaTecnica" type="text">
                    <button id="btnFichaTecnica" type="submit" class="pure-button">Escolher</button>
                </div>
                <div class="pure-control-group tipo-capa-group">
                    <label for="tipo_capa">Escolher tipo de capa</label>
                    <select id="tipo_capa">
                        <option value="N">Normal</option>
                        <option value="T">Alta</option>
                        <option value="W">Comprida</option>
                    </select>
                    <p>Dimensão da capa (em pixels): <span>alt 144 x larg 144</span></p>
                </div>
                <div class="pure-control-group">
                    <input class="hidden-input capa" accept="image/*" type="file" name="file">
                    <label for="capa">Escolher capa</label>
                    <input readonly id="capa" type="text">
                    <button id="btnCapa" class="pure-button">Escolher</button>
                </div>
                <div class="pure-control-group">
                    <input class="hidden-input imagens" accept="image/*" multiple="multiple" type="file" name="file[]">
                    <label for="btnImagens">Escolher imagens</label>
                    <button id="btnImagens" class="pure-button">Adicionar</button>
                    <button id="btnImagensClear" class="pure-button">Limpar</button>
                </div>
                <div class="box-images">
                    <h5>Imagens Escolhidas</h5>
                    <div class="images">
                    </div>
                </div>
                <div class="pure-control-group">
                    <label for="videos">Adicionar Videos</label>
                    <input id="videos" type="url" placeholder="http://...">
                    <button id="btnVideos" class="pure-button">Adicionar</button>
                    <button id="btnVideosClear" class="pure-button">Limpar tudo</button>
                </div>
                <div class="box-videos">
                    <h5>Videos Escolhidos</h5>
                    <div class="videos">
                    </div>
                </div>
            </div>
            <div class="pure-u-1-2">
                <h2>Informação do Autor</h2>
                <div class="pure-control-group">
                    <label for="autor">Nome do Autor</label>
                    <input id="autor" type="text">
                </div>
                <div class="pure-control-group">
                    <label for="autorBio">Bio do Autor</label>
                    <textarea id="autorBio"></textarea>
                </div>
            </div>
        </div>
        </div>
        <br>
        <br>
        <div class="pure-control-group">
            <div id="gbnt-btn-criar" class="pure-button pure-button-primary">Gravar dados</div>
        </div>
        <div class="pure-control-group">
            <input class="hidden-input upload" accept=".json" type="file" name="file">
            <div id="gbnt-btn-upload" class="pure-button">Fazer upload dum ficheiro existente</div>
        </div>
        <hr>
    </form>
    <script src="js/libs.dist.js"></script>
    <script type="text/javascript">
    $(document).ready(function() {
        window.obj_pt = initializeObj("pt");
        window.obj_en = initializeObj("en");
        window.obj_current = obj_pt;

        setFormData(window.obj_current);

        /**********************
         * LANGUAGE TOGGLE
         **********************/
        $('#idioma').on("change", $.proxy(function() {
            window.obj_pt.ano = $("#ano").val();
            window.obj_en.ano = $("#ano").val();
            window.obj_pt.capa = $("#capa").val();
            window.obj_en.capa = $("#capa").val();
            window.obj_pt.tipo_capa = $("#tipo_capa").val();
            window.obj_en.tipo_capa = $("#tipo_capa").val();

            if ($("#idioma").val() === "pt") {
                storeCurrentData();
                window.obj_current = window.obj_pt;
                setFormData();
            } else {
                storeCurrentData();
                window.obj_current = window.obj_en;
                setFormData();
            }
        }, this));

        /**********************
         * SAVE JSON FILE
         **********************/
        $('#gbnt-btn-criar').click(function() {
            var file = criarFile();
            var pom = document.createElement('a');
            pom.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(JSON.stringify(file)));
            pom.setAttribute('download', "sumario.json");
            pom.click();
        });

        /**********************
         * UPLOAD JSON FILE
         **********************/
        // upload json: btn clicked
        $('#gbnt-btn-upload').click(function(e) {
            $(".hidden-input.upload").click();
            e.preventDefault();
            return false;
        });
        // upload json: trigger input field
        $('.hidden-input.upload').change(function(ee) {
            var reader = new FileReader();
            reader.onload = function(event) {
                var obj = JSON.parse(event.target.result);
                window.obj_pt = obj[0];
                window.obj_en = obj[1];
                window.obj_current = obj_pt;
                $("#idioma").val("pt");
                setFormData(window.obj_current);
                if ($("#tipo_capa").val() === "N") {
                    $(".tipo-capa-group span").html("alt 144 x larg 144");
                }

                if ($("#tipo_capa").val() === "W") {
                    $(".tipo-capa-group span").html("alt 144 x larg 288");
                }

                if ($("#tipo_capa").val() === "T") {
                    $(".tipo-capa-group span").html("alt 288 x larg 144");
                }
            };
            reader.onerror = function(event) {
                alert("Erro com o upload desse ficheiro!");
            };
            reader.readAsText(this.files[0]);
            return false;
        });

        /**********************
         * FICHA TECNICA
         **********************/
        // ficha tecnica: btn clicked
        $('#btnFichaTecnica').click(function(e) {
            $(".hidden-input.ficha-tecnica").click();
            e.preventDefault();
            return false;
        });
        // ficha tecnica: trigger input field
        $('.hidden-input.ficha-tecnica').change(function(ee) {
            $("#fichaTecnica").val(this.files[0].name);
        });


        /**********************
         * CAPA
         **********************/
        // capa: btn clicked
        $('#btnCapa').click(function(e) {
            $(".hidden-input.capa").click();
            e.preventDefault();
            return false;
        });
        // capa: trigger input field
        $('.hidden-input.capa').change(function(ee) {
            $("#capa").val(this.files[0].name);
        });



        /**********************
         * TIPO DE CAPA
         **********************/
        $('#tipo_capa').on("change", function() {
            window.obj_pt.tipo_capa = $("#tipo_capa").val();
            window.obj_en.tipo_capa = $("#tipo_capa").val();

            if ($("#tipo_capa").val() === "N") {
                $(".tipo-capa-group span").html("alt 144 x larg 144");
            }

            if ($("#tipo_capa").val() === "W") {
                $(".tipo-capa-group span").html("alt 144 x larg 288");
            }

            if ($("#tipo_capa").val() === "T") {
                $(".tipo-capa-group span").html("alt 288 x larg 144");
            }
        });


        /**********************
         * IMAGES UPLOAD
         **********************/
        // imagens_upload: btn UPLOAD clicked
        $('#btnImagens').click(function(e) {
            $(".hidden-input.imagens").click();
            e.preventDefault();
            return false;
        });
        // imagens_upload: trigger input field
        $('.hidden-input.imagens').change(function(ee) {
            var imagens = this.files;

            for (var i = 0; i < imagens.length; i++) {
                for (var ii = 0; ii < window.obj_pt.imagens.length; ii++) {
                    if (imagens[i].name === window.obj_pt.imagens[ii]) {
                        return; //if the image is already there, get out of here
                    }
                }
                $(".images").append("<p>" + imagens[i].name + "</p>");
                window.obj_pt.imagens.push(imagens[i].name);
                window.obj_en.imagens.push(imagens[i].name);
            }
            $(".box-images").show();
        });
        // imagens_upload: btn CLEAR clicked
        $('#btnImagensClear').click(function(e) {
            $(".images").empty();
            $(".box-images").hide();
            window.obj_pt.imagens = [];
            window.obj_en.imagens = [];
            e.preventDefault();
            return false;
        });



        /**********************
         * VIDEOS UPLOAD
         **********************/
        // videos_upload: btn UPLOAD clicked
        $('#btnVideos').click(function(e) {
            e.preventDefault();
            var video = $("#videos").val();

            if (!video) {
                return;
            }

            for (var ii = 0; ii < window.obj_pt.videos.length; ii++) {
                if (video === window.obj_pt.videos[ii]) {
                    return; //if the video is already there, get out of here
                }
            }
            $(".videos").append("<p>" + video + "</p>");
            window.obj_pt.videos.push(video);
            window.obj_en.videos.push(video);
            $(".box-videos").show();
        });
        // videos_upload: btn CLEAR clicked
        $('#btnVideosClear').click(function(e) {
            $(".videos").empty();
            $(".box-videos").hide();
            window.obj_pt.videos = [];
            window.obj_en.videos = [];
            e.preventDefault();
            return false;
        });
    });

    function storeCurrentData() {
        var imgDiv = $(".box-images .images");
        var videosDiv = $(".box-videos .videos");

        window.obj_current.titulo = $("#titulo").val();
        window.obj_current.autor = $("#autor").val();
        window.obj_current.ano = $("#ano").val();
        window.obj_current.autorBio = $("#autorBio").val();
        window.obj_current.descricao = $("#descricao").val();
        window.obj_current.www = $("#www").val();
        window.obj_current.fichaTecnica = $("#fichaTecnica").val();
        window.obj_current.capa = $("#capa").val();
        window.obj_current.tipo_capa = $("#tipo_capa").val();
        window.obj_current.imagens = [];
        window.obj_current.videos = [];

        $.each(imgDiv[0].childNodes, function(key, value) {
            window.obj_current.imagens.push(value.innerHTML);
        });

        $.each(videosDiv[0].childNodes, function(key, value) {
            window.obj_current.videos.push(value.innerHTML);
        });

    }

    function setFormData() {

        if (window.obj_current.language === "pt") {
            $("#idioma").val("pt");
        } else {
            $("#idioma").val("en");
        }

        $("#titulo").val(window.obj_current.titulo);
        $("#autor").val(window.obj_current.autor);
        $("#ano").val(window.obj_current.ano);
        $("#autorBio").val(window.obj_current.autorBio);
        $("#descricao").val(window.obj_current.descricao);
        $("#www").val(window.obj_current.www);
        $("#fichaTecnica").val(window.obj_current.fichaTecnica);
        $("#capa").val(window.obj_current.capa);
        $("#tipo_capa").val(window.obj_current.tipo_capa);

        if (window.obj_current.imagens.length > 0) {
            $(".images").empty();
            for (var i = 0; i < window.obj_current.imagens.length; i++) {
                $(".images").append("<p>" + window.obj_current.imagens[i] + "</p>");
            }
            $(".box-images").show();
        } else {
            $(".images").empty();
            $(".box-images").hide();
        }

        if (window.obj_current.videos.length > 0) {
            $(".videos").empty();
            for (var ii = 0; ii < window.obj_current.videos.length; ii++) {
                $(".videos").append("<p>" + window.obj_current.videos[ii] + "</p>");
            }
            $(".box-videos").show();
        } else {
            $(".videos").empty();
            $(".box-videos").hide();
        }

    }

    function initializeObj(language) {
        var obj = {};
        obj.language = language;
        obj.capa = "";
        obj.tipo_capa = "N";
        obj.titulo = "";
        obj.autor = "";
        obj.ano = "";
        obj.fichaTecnica = null;
        obj.autorBio = "";
        obj.descricao = "";
        obj.www = null;
        obj.imagens = [];
        obj.videos = [];

        return obj;
    }

    function criarFile() {

        storeCurrentData();

        var obj = [];
        obj.push(window.obj_pt);
        obj.push(window.obj_en);

        return obj;
    }
    </script>
</body>

</html>
