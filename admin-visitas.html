<!DOCTYPE html>
<!-- 
   Hi, you're looking at a web page built with love by:

   Ricardo

  /$$$$$$            /$$             /$$                        
 /$$__  $$          |__/            | $$                        
| $$  \ $$ /$$   /$$ /$$ /$$$$$$$  /$$$$$$    /$$$$$$   /$$$$$$$
| $$  | $$| $$  | $$| $$| $$__  $$|_  $$_/   |____  $$ /$$_____/
| $$  | $$| $$  | $$| $$| $$  \ $$  | $$      /$$$$$$$|  $$$$$$ 
| $$/$$ $$| $$  | $$| $$| $$  | $$  | $$ /$$ /$$__  $$ \____  $$
|  $$$$$$/|  $$$$$$/| $$| $$  | $$  |  $$$$/|  $$$$$$$ /$$$$$$$/
 \____ $$$ \______/ |__/|__/  |__/   \___/   \_______/|_______/ 
      \__/                                                                      

   ricardoquintas.com   
   January/2015 
-->
<html>

<head>
    <meta charset="utf-8" />
    <title>ADMIN unplace.org</title>
    <link rel="stylesheet" href="css/pure-min.css" />
    <link rel="stylesheet" href="css/jquery.cleditor.css" />
    <style type="text/css">
    * {
        -webkit-box-sizing: border-box;
        -moz-box-sizing: border-box;
        box-sizing: border-box;
    }
    
    body {
        margin: 50px;
        background-color: #fff;
    }
    
    .button-warning {
        background: rgb(223, 117, 20);
        color: white;
        border-radius: 4px;
        text-shadow: 0 1px 1px rgba(0, 0, 0, 0.2);
    }
    
    .hidden-input {
        display: none !important;
    }
    
    .tipo-capa-group p {
        display: inline;
        margin-left: 10px;
        font-size: 12px;
        color: red;
    }
    
    .box-images {
        margin-top: 10px;
        margin-bottom: 10px;
        padding: 10px;
        display: none;
        background-color: #ddd
    }
    
    .box-images h5 {
        margin: 0px;
    }
    
    .box-images .images p {
        margin: 8px;
        font-size: 12px;
        color: red;
    }
    
    .box-videos {
        margin-top: 10px;
        margin-bottom: 10px;
        padding: 10px;
        display: none;
        background-color: #ddd
    }
    
    .box-videos h5 {
        margin: 0px;
    }
    
    .box-videos .videos p {
        margin: 8px;
        font-size: 12px;
        color: red;
    }
    
    .browserupdate {
        display: block;
        margin-bottom: 3em;
        padding: 2em;
        color: #fff;
        text-align: center;
        background-color: red;
    }
    
    .browserupdate a {
        color: #fff;
        text-decoration: underline;
    }
    
    .browserupdate a:hover {
        color: #ddd;
    }
    
    .cleditorMain {
        margin-left: 180px;
        margin-top: -20px;
    }
    </style>
    <script type="text/javascript" src="http://fast.fonts.net/jsapi/739bf436-1824-4067-a456-9bd34cfd8f44.js"></script>
</head>

<body>
    <!--[if lte IE 9]>
    <div class="browserupdate">
        You are using an obsolete browser which can harm your experience and cause security troubles.
        <br> Please <a href="http://browsehappy.com/" target="_blank">update your browser!</a>
    </div>
  <![endif]-->
    <noscript>
        <div class="browserupdate">
            Oh, no! You don't have JavaScript enabled on your browser!
            <br> This website only works with JavaScript. Sorry.
        </div>
    </noscript>
    <a class="button-warning pure-button" href="admin.html">Gerir Obras</a>
    <hr>
    <form id="myForm" action="downloadJSON.php" method="post" class="pure-form  pure-form-aligned">
        <input type="hidden" name="data" id="data">
        <input type="hidden" name="filename" id="filename">
        <div class="pure-control-group">
            <label for="idioma">Escolher idioma</label>
            <select id="idioma">
                <option value="pt">PT</option>
                <option value="en">EN</option>
            </select>
        </div>
        <h2>Informa&ccedil;&atilde;o da Visita 1</h2>
        <div class="pure-control-group">
            <label for="nome_visita_1">Nome Visita</label>
            <input id="nome_visita_1" type="text">
        </div>
        <div class="pure-control-group">
            <label for="descricao_visita_1">Descri&ccedil;&atilde;o Visita</label>
            <textarea id="descricao_visita_1"></textarea>
        </div>
        <div class="pure-control-group">
            <label for="projectos_1">Projectos da visita</label>
            <input id="projectos_1" type="text" placeholder="ex: 1,2,3,4">
        </div>
        <br>
        <h2>Informa&ccedil;&atilde;o da Visita 2</h2>
        <div class="pure-control-group">
            <label for="nome_visita_2">Nome Visita</label>
            <input id="nome_visita_2" type="text">
        </div>
        <div class="pure-control-group">
            <label for="descricao_visita_2">Descri&ccedil;&atilde;o Visita</label>
            <textarea id="descricao_visita_2"></textarea>
        </div>
        <div class="pure-control-group">
            <label for="projectos_2">Projectos da visita</label>
            <input id="projectos_2" type="text" placeholder="ex: 1,2,3,4">
        </div>
        <br>
        <h2>Informa&ccedil;&atilde;o da Visita 3</h2>
        <div class="pure-control-group">
            <label for="nome_visita_3">Nome Visita</label>
            <input id="nome_visita_3" type="text">
        </div>
        <div class="pure-control-group">
            <label for="descricao_visita_3">Descri&ccedil;&atilde;o Visita</label>
            <textarea id="descricao_visita_3"></textarea>
        </div>
        <div class="pure-control-group">
            <label for="projectos_3">Projectos da visita</label>
            <input id="projectos_3" type="text" placeholder="ex: 1,2,3,4">
        </div>
        <br>
        <br>
        <br>
        <div class="pure-control-group">
            <div id="gbnt-btn-criar" class="pure-button pure-button-primary">Gravar dados</div>
        </div>
        <div class="pure-control-group">
            <input class="hidden-input upload" accept=".json" type="file" name="file">
            <div id="gbnt-btn-upload" class="pure-button">Fazer upload dum ficheiro existente</div>
        </div>
        <hr>
    </form>
    <script src="js/libs.dist.js"></script>
    <script src="js/jquery.cleditor.min.js"></script>
    <script type="text/javascript">
    $(document).ready(function() {

        // // adds the WYSIWYG editor to field
        $("#descricao_visita_1").cleditor({
            width: 300,
            controls: "bold italic | " +
                "color highlight removeformat | " +
                "link unlink"
        });

        $("#descricao_visita_2").cleditor({
            width: 300,
            controls: "bold italic | " +
                "color highlight removeformat | " +
                "link unlink"
        });

        $("#descricao_visita_3").cleditor({
            width: 300,
            controls: "bold italic | " +
                "color highlight removeformat | " +
                "link unlink"
        });

        window.obj_pt = initializeObj("pt");
        window.obj_en = initializeObj("en");
        window.obj_current = obj_pt;

        setFormData(window.obj_current);

        /**********************
         * LANGUAGE TOGGLE
         **********************/
        $('#idioma').on("change", $.proxy(function() {
            window.obj_pt.projectos_1 = $("#projectos_1").val();
            window.obj_en.projectos_1 = $("#projectos_1").val();
            window.obj_pt.projectos_2 = $("#projectos_2").val();
            window.obj_en.projectos_2 = $("#projectos_2").val();
            window.obj_pt.projectos_3 = $("#projectos_3").val();
            window.obj_en.projectos_3 = $("#projectos_3").val();

            if ($("#idioma").val() === "pt") {
                storeCurrentData();
                window.obj_current = window.obj_pt;
                setFormData();
            } else {
                storeCurrentData();
                window.obj_current = window.obj_en;
                setFormData();
            }
        }, this));

        /**********************
         * SAVE JSON FILE
         **********************/
        $('#gbnt-btn-criar').click(function() {
            var file = criarFile();
            console.log("file: " + file);
            console.log("stringify: " + JSON.stringify(file));
            var encodedFile = encodeURIComponent(JSON.stringify(file));
            console.log("encodedFile: " + encodedFile);
            $("#data").val(encodedFile);
            $("#filename").val("visitas.json");
            $("#myForm").submit();
            // window.location.href = 'downloadJSON.php?filename=visitas.json&data=' + encodedFile;
            // var file = criarFile();
            // var pom = document.createElement('a');
            // pom.setAttribute('href','data:text/plain;charset=utf-8,' + encodeURIComponent(JSON.stringify(file)));
            // pom.setAttribute('download', "visitas.json");
            // pom.click();
        });

        /**********************
         * UPLOAD JSON FILE
         **********************/
        // upload json: btn clicked
        $('#gbnt-btn-upload').click(function(e) {
            $(".hidden-input.upload").click();
            e.preventDefault();
            return false;
        });
        // upload json: trigger input field
        $('.hidden-input.upload').change(function(ee) {
            var reader = new FileReader();
            reader.onload = function(event) {
                var obj = JSON.parse(event.target.result);
                window.obj_pt = obj[0];
                window.obj_en = obj[1];
                window.obj_current = obj_pt;
                $("#idioma").val("pt");
                setFormData(window.obj_current);
            };
            reader.onerror = function(event) {
                alert("Erro com o upload desse ficheiro!");
            };
            reader.readAsText(this.files[0]);
            return false;
        });

    });

    function storeCurrentData() {

        window.obj_current.nome_visita_1 = $("#nome_visita_1").val();
        window.obj_current.descricao_visita_1 = $("#descricao_visita_1").val();
        window.obj_current.projectos_1 = $("#projectos_1").val();

        window.obj_current.nome_visita_2 = $("#nome_visita_2").val();
        window.obj_current.descricao_visita_2 = $("#descricao_visita_2").val();
        window.obj_current.projectos_2 = $("#projectos_2").val();

        window.obj_current.nome_visita_3 = $("#nome_visita_3").val();
        window.obj_current.descricao_visita_3 = $("#descricao_visita_3").val();
        window.obj_current.projectos_3 = $("#projectos_3").val();

    }

    function setFormData() {

        if (window.obj_current.language === "pt") {
            $("#idioma").val("pt");
        } else {
            $("#idioma").val("en");
        }

        $("#nome_visita_1").val(window.obj_current.nome_visita_1);
        $("#descricao_visita_1").val(window.obj_current.descricao_visita_1);
        $("#projectos_1").val(window.obj_current.projectos_1);

        $("#nome_visita_2").val(window.obj_current.nome_visita_2);
        $("#descricao_visita_2").val(window.obj_current.descricao_visita_2);
        $("#projectos_2").val(window.obj_current.projectos_2);

        $("#nome_visita_3").val(window.obj_current.nome_visita_3);
        $("#descricao_visita_3").val(window.obj_current.descricao_visita_3);
        $("#projectos_3").val(window.obj_current.projectos_3);

        updateWYSIWYGeditor();

    }

    function initializeObj(language) {
        var obj = {};

        obj.language = language;

        obj.nome_visita_1 = "";
        obj.descricao_visita_1 = "";
        obj.projectos_1 = "";

        obj.nome_visita_2 = "";
        obj.descricao_visita_2 = "";
        obj.projectos_2 = "";

        obj.nome_visita_3 = "";
        obj.descricao_visita_3 = "";
        obj.projectos_3 = "";

        return obj;
    }

    function updateWYSIWYGeditor() {
        $("#descricao_visita_1").cleditor()[0].updateFrame();
        $("#descricao_visita_2").cleditor()[0].updateFrame();
        $("#descricao_visita_3").cleditor()[0].updateFrame();
    }

    function criarFile() {

        storeCurrentData();

        window.obj_pt.projectos_1 = $("#projectos_1").val();
        window.obj_en.projectos_1 = $("#projectos_1").val();
        window.obj_pt.projectos_2 = $("#projectos_2").val();
        window.obj_en.projectos_2 = $("#projectos_2").val();
        window.obj_pt.projectos_3 = $("#projectos_3").val();
        window.obj_en.projectos_3 = $("#projectos_3").val();

        var obj = [];
        obj.push(window.obj_pt);
        obj.push(window.obj_en);

        return obj;
    }
    </script>
</body>

</html>
